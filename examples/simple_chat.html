<!DOCTYPE html>
<html>
<head>
	<title>Chat Page</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
	<div id="messages"></div>
	<form>
		<label for="name">Name:</label>
		<input type="text" id="name" name="name"><br><br>
		<label for="message">Message:</label>
		<input type="text" id="message" name="message"><br><br>
		<input type="submit" value="Send Message">
	</form>

	<script>
		// Define the API endpoints
        const ENDPOINT = "http://127.0.0.1:8000/a";


		// Function to update the messages div
		function updateMessages(messages) {
			const messagesDiv = document.getElementById('messages');
			messagesDiv.innerHTML = '';
			messages.forEach(message => {
				messagesDiv.innerHTML += `<p>${message.name}: ${message.message}</p>`;
			});
		}

		// Function to poll for new messages
		function pollMessages() {
			fetch(ENDPOINT, {
                method: "GET",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ service: "get all messages", data: "" }),
              })
			.then(response => response.json())
			.then(data => {
				updateMessages(data);
			});
		}

		// Start polling for new messages
		setInterval(pollMessages, 1000); // Poll every 1 second

		// Handle form submission
		const form = document.querySelector('form');
		form.addEventListener('submit', event => {
			event.preventDefault();

			// Get the name and message from the form
			const nameInput = document.getElementById('name');
			const messageInput = document.getElementById('message');
			const name = nameInput.value;
			const message = messageInput.value;

			// Send the message to the API
			fetch(ENDPOINT, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            service: "send a message",
            data: `Name: ${name}, Message: ${message}`,
          }),
        })
			.then(response => response.json())
			.then(data => {
				// Clear the form
				nameInput.value = '';
				messageInput.value = '';
			});
		});
	</script>
</body>
</html>


<!-- <!DOCTYPE html>
<html>
  <head>
    <title>Chat Page</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body>
    <div id="messages"></div>
    <form>
      <label for="name">Name:</label>
      <input type="text" id="name" name="name" /><br /><br />
      <label for="message">Message:</label>
      <input type="text" id="message" name="message" /><br /><br />
      <input type="submit" value="Send Message" />
    </form>

    <script>
      // Define the API endpoints
      const ENDPOINT = "http://127.0.0.1:8000/a";

      // Handle form submission
      const form = document.querySelector("form");
      form.addEventListener("submit", (event) => {
        event.preventDefault();

        console.log('submit');
        console.log(event);

        // Get the name and message from the form
        const nameInput = document.getElementById("name");
        const messageInput = document.getElementById("message");
        const name = nameInput.value;
        const message = messageInput.value;

        // Send the message to the API
        fetch(ENDPOINT, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            service: "send a message",
            data: `Name: ${name}, Message: ${message}`,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            // Poll the API until the message is ready
            const poll = setInterval(() => {
              fetch(`${ENDPOINT}${data.task_id}` , {
                method: "GET",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ service: "get all messages", data: "" }),
              })
                .then((response) => response.json())
                .then((data) => {
                  // Check if the message is ready
                  const message = data.find((m) => m.status !== "running" && m.id === data.id);
                  if (message) {
                    // Display the message on the page
                    const messagesDiv = document.getElementById("messages");
                    messagesDiv.innerHTML += `<p>${message.name}: ${message.message}</p>`;

                    // Clear the form
                    nameInput.value = "";
                    messageInput.value = "";

                    // Stop polling
                    clearInterval(poll);
                  }
                });
            }, 1000); // Poll every 1 second
          });
      });
    </script>
  </body>
</html> -->
